{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mei-services.de</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/output.css' %}">
   
    <script src="https://cdn.jsdelivr.net/npm/tw-elements/dist/js/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19"></script>
</head>
<body class="flex items-center justify-center h-screen bg-cover bg-center" style="background-image: url('{% static 'backgrounds/login.jpg' %}'); opacity: 0.8;">

    
    <div class="card bg-white shadow-xl rounded-lg p-6 w-96">
        <h2 class="text-3xl font-bold text-center text-gray-700 mb-6">mei-services.de</h2>
        <form method="post">
            <input type="hidden" id="force-login" name="force_login" value="0">

            {% if form.non_field_errors and form.non_field_errors.0 == 'already_logged_in' %}
            <input type="checkbox" id="session-modal" class="modal-toggle" checked />
            <div class="modal modal-open">
            <div class="modal-box">
                <h3 class="font-bold text-lg">Sitzung bereits aktiv</h3>
                <p class="py-4">
                Eine andere Sitzung ist für dieses Konto aktiv.<br>
                Möchten Sie die andere Sitzung beenden und hier fortfahren?
                </p>
                <div class="modal-action flex gap-2">
                <button type="button" class="btn" id="force-login-btn">Ja</button>

                <label for="session-modal" class="btn btn-ghost" onclick="window.location.href='{% url 'login' %}'">Nein</label>
                </div>
            </div>
            </div>
            {% endif %}

            
            

            {% csrf_token %}
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-medium">Username</span>
                </label>
                <input 
                    type="text" 
                    name="username" 
                    class="input input-bordered w-full" 
                    placeholder="Enter your username" 
                    required>
            </div>
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-medium">Password</span>
                </label>
                <input 
                    type="password" 
                    name="password" 
                    class="input input-bordered w-full" 
                    placeholder="Enter your password" 
                    required>
            </div>
            <div class="form-control mt-6">
                <button type="submit" class="btn btn-primary btn-outline w-full">Login</button>
            </div>
        </form>
    </div>
</body>
<script>
    document.getElementById('force-login-btn')?.addEventListener('click', function () {
        const form = document.querySelector('form');
        if (form) {
            const forceInput = document.getElementById('force-login');
            if (forceInput) {
                forceInput.value = '1';
            }
    
            // Resubmit the same credentials (pull them from previous inputs)
            const usernameInput = document.createElement("input");
            usernameInput.type = "hidden";
            usernameInput.name = "username";
            usernameInput.value = localStorage.getItem("temp_username") || "";
            form.appendChild(usernameInput);
    
            const passwordInput = document.createElement("input");
            passwordInput.type = "hidden";
            passwordInput.name = "password";
            passwordInput.value = localStorage.getItem("temp_password") || "";
            form.appendChild(passwordInput);
    
            form.submit();
        }
    });
    
    // Save credentials on first form attempt
    document.querySelector('form')?.addEventListener('submit', function () {
        const username = document.querySelector('input[name="username"]')?.value;
        const password = document.querySelector('input[name="password"]')?.value;
        localStorage.setItem("temp_username", username);
        localStorage.setItem("temp_password", password);
    });
    </script>
    
    
</html>
